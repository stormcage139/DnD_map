{% extends "map/base.html" %}
{% block bonus_style %}

        .npc-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            max-height: 800px;
            overflow-y: auto;
            border: 1px solid rgba(139, 90, 43, 0.3);
            padding: 10px;
        }
        .npc-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 10px;
        }
        .npc-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(139, 90, 43, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            height: fit-content;
        }
        .npc-card:hover {
            background: rgba(139, 90, 43, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 90, 43, 0.2);
        }
        .npc-image {
            width: 100%;
            height: 156px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid rgba(139, 90, 43, 0.2);
        }
        .npc-name {
            color: #8b5a2b;
            font-weight: 500;
            font-size: 1.5rem;
            margin: 0;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .npc-card:hover .npc-name {
            color: #5d3d1c;
        }
        .no-image {
            width: 100%;
            height: 156px;
            background: rgba(139, 90, 43, 0.1);
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cdaa7d;
            font-size: 0.9rem;
            border: 1px solid rgba(139, 90, 43, 0.2);
        }
        .search-box {
            position: relative;
            width: 100%;
            margin-bottom: 15px;
        }
        .search-input {
            width: 95%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            outline: none;
            font-size: 16px;
        }
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .suggestions {
            position: absolute;
            width: 100%;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
        }
        .suggestion-item {
            display:block;
            padding: 10px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background: #f0f0f0;
        }
        .npc-item a{
            width: 100%;
            height: 100%;
            color: #cdaa7d;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        .npc-item a:hover {
            color: #8b5a2b;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            .npc-container {
                max-height: 600px;
                padding: 8px;
            }
            .npc-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 5px;
            }
            .npc-card {
                padding: 12px;
            }
            .npc-image, .no-image {
                height: 130px;
            }
            .npc-name {
                font-size: 1.35rem;
            }
            .search-input {
                font-size: 16px; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
                padding: 12px;
            }
            .suggestions {
                max-height: 150px;
            }
            .suggestion-item {
                padding: 8px;
                font-size: 0.95rem;
            }
        }
        
        @media (max-width: 480px) {
            .npc-container {
                max-height: 500px;
                padding: 5px;
            }
            .npc-grid {
                grid-template-columns: 1fr;
                gap: 8px;
                padding: 3px;
            }
            .npc-card {
                padding: 10px;
            }
            .npc-image, .no-image {
                height: 104px;
            }
            .npc-name {
                font-size: 1.275rem;
            }
            .search-input {
                padding: 10px;
                font-size: 16px;
            }
        }
{% endblock bonus_style %}

{% block mainsector %}
<h2 style="text-align:center">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ù–ü–°</h2>
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫ NPC...">
{% comment %}
                <span class="search-icon">üîç</span>
{% endcomment %}
            <div class="suggestions" id="suggestions">
                <a class="suggestion-item" id="suggestion"></a>
            </div>

        </div>
    <div class="npc-container">
        <div class="npc-grid" id="npcList">
            {% for npc in npc_list %}   
            <div class="npc-card" data-name="{{ npc.name }}" onclick="window.location.href='{% url "npc_page" npc.slug %}'">
                {% if npc.image %}
                    <img src="{{ npc.image.url }}" alt="{{ npc.name }}" class="npc-image">
                {% else %}
                    <div class="no-image">–ù–µ—Ç —Ñ–æ—Ç–æ</div>
                {% endif %}
                <h3 class="npc-name">{{ npc.name }}</h3>
            </div>
            {% endfor %}
        </div>
    </div>
    <p>–≤—Å–µ–≥–æ –ù–ü–°:{{ npc_list|length }}</p>
    <script>
        const suggestionsElement = document.getElementById('suggestions');
        const searchInputElement = document.getElementById('searchInput');
        const suggestionElement = document.getElementById('suggestion');

        searchInputElement.addEventListener('input', () => {
            suggestionsElement.style.display = 'block';
            const FindedNPC = NpcFinder(searchInputElement.value)
            suggestionElement.textContent = FindedNPC.textContent;
            suggestionElement.href = FindedNPC.href;
        });
        searchInputElement.addEventListener('focus', () => {
            if (searchInputElement.value.trim().length === 0){
                return;
            }
            suggestionsElement.style.display = 'block';
        });

        searchInputElement.addEventListener('blur', (event) => {
            if(event.relatedTarget && event.relatedTarget.id === "suggestion"){
                return
            }
            suggestionsElement.style.display = 'none';

        });



        const npcItemElements = document.getElementsByClassName('npc-card')

        const NpcFinder = (npcName) => {
            for ( let i = 0; i < npcItemElements.length; i++) {
                if (npcItemElements[i].innerText.toLowerCase().includes(npcName.toLowerCase())){
                    return {
                        textContent: npcItemElements[i].querySelector('.npc-name').textContent,
                        href: npcItemElements[i].onclick.toString().match(/window\.location\.href='([^']+)'/)[1]
                    };
                }

            }
        }

    </script>
{% endblock mainsector %}
