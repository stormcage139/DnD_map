{% extends "map/base.html" %}
{% block bonus_style %}

        .npc-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            max-height: 800px;
            overflow-y: auto;
            border: 1px solid rgba(139, 90, 43, 0.3);
            padding: 10px;
        }
        .npc-item {
            padding: 15px;
            border-bottom: 1px solid rgba(139, 90, 43, 0.3);
            transition: background-color 0.3s ease;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        .npc-item:hover {
            background: rgba(139, 90, 43, 0.1);
        }
        .npc-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .search-box {
            position: relative;
            width: 100%;
            margin-bottom: 15px;
        }
        .search-input {
            width: 95%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 20px;
            outline: none;
            font-size: 16px;
        }
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .suggestions {
            position: absolute;
            width: 100%;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
        }
        .suggestion-item {
            display:block;
            padding: 10px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background: #f0f0f0;
        }
        .npc-item a{
            width: 100%;
            height: 100%;
            color: #cdaa7d;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        .npc-item a:hover {
            color: #8b5a2b;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            .npc-container {
                max-height: 600px;
                padding: 8px;
            }
            .npc-item {
                padding: 12px;
                margin-bottom: 3px;
            }
            .npc-item a {
                font-size: 1rem;
            }
            .search-input {
                font-size: 16px; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑—É–º –Ω–∞ iOS */
                padding: 12px;
            }
            .suggestions {
                max-height: 150px;
            }
            .suggestion-item {
                padding: 8px;
                font-size: 0.95rem;
            }
        }
        
        @media (max-width: 480px) {
            .npc-container {
                max-height: 500px;
                padding: 5px;
            }
            .npc-item {
                padding: 10px;
            }
            .npc-item a {
                font-size: 0.95rem;
            }
            .search-input {
                padding: 10px;
                font-size: 16px;
            }
        }
{% endblock bonus_style %}

{% block mainsector %}
<h2 style="text-align:center">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ù–ü–°</h2>
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫ NPC...">
            <span class="search-icon">üîç</span>
            <div class="suggestions" id="suggestions">
                <a class="suggestion-item" id="suggestion"></a>
            </div>

        </div>
    <div class="npc-container">
        <div id="npcList">
            {% for npc in npc_list %}   
            <div class="npc-item" data-name="{{ npc.name }}" ur="{% url "npc_page" npc.slug %}"><a href="{% url "npc_page" npc.slug %}">{{ npc.name }}</a></div>
            {% endfor %}
        </div>
    </div>
    <p>–≤—Å–µ–≥–æ –ù–ü–°:{{ npc_list|length }}</p>
    <script>
        const suggestionsElement = document.getElementById('suggestions');
        const searchInputElement = document.getElementById('searchInput');
        const suggestionElement = document.getElementById('suggestion');

        searchInputElement.addEventListener('input', () => {
            suggestionsElement.style.display = 'block';
            const FindedNPC = NpcFinder(searchInputElement.value)
            suggestionElement.textContent = FindedNPC.textContent;
            suggestionElement.href = FindedNPC.href;
        });
        searchInputElement.addEventListener('focus', () => {
            if (searchInputElement.value.trim().length === 0){
                return;
            }
            suggestionsElement.style.display = 'block';
        });

        searchInputElement.addEventListener('blur', (event) => {
            if(event.relatedTarget && event.relatedTarget.id === "suggestion"){
                return
            }
            suggestionsElement.style.display = 'none';

        });



        const npcItemElements = document.getElementsByClassName('npc-item')

        const NpcFinder = (npcName) => {
            for ( let i = 0; i < npcItemElements.length; i++) {
                if (npcItemElements[i].innerText.toLowerCase().includes(npcName.toLowerCase())){
                    return npcItemElements[i].firstElementChild;
                }

            }
        }

    </script>
{% endblock mainsector %}
